function BrightCropper(a){a.canvas_object.canvas().append("g").append("defs").append("clipPath").attr("id","clippast").append("rect").attr("width",a.canvas_object.inner_width()).attr("height",a.canvas_object.inner_height());a.canvas_object.chart_space().attr("clip-path","url(#clippast)");a.canvas_object.canvas().append("g").append("defs").append("clipPath").attr("id","cropxaxisright").append("rect").attr("transform","translate(-5,"+(a.canvas_object.inner_height()-2)+")").attr("width",a.canvas_object.inner_width()+
5).attr("height",20);return{}};function BrightListener(a){function b(){}var d=a.initial_dataset(),f=a.x_scale(new Date(0))-a.x_scale(new Date(864E5)),e=a.chart,g=a.painted_x_axis,h=a.painted_y_axis,c=a.area,m=1;b.push=function(k){d.push(k);k=a.reader({dataset:function(){return d}});var l=a.scales({y_max:k.y_max,dataset:k.dataset,width:function(){return a.width()-f},height:a.height}),n=a.axis({skip:!0,painted_x:g,painted_y:h,canvas:a.canvas,x_scale:l.x_scale,y_scale:l.y_scale,height:a.height}),p=d3.svg.area().interpolate("monotone").x(function(c){return a.x_scale(c.date)}).y0(function(a){return l.y_scale(a.y0)}).y1(function(a){return l.y_scale(a.y0+
a.y)});e.data(k.stacked_dataset()).attr("transform","translate("+f*(m-1)+",0)").attr("d",function(a){return c(a.values)}).transition().duration(1E3).attr("transform","translate("+f*m+",0)").attr("d",function(a){return p(a.values)});h.transition().duration(1E3).call(n.y_axis);n.painted_x_axis.attr("transform","translate("+0*f+","+a.height()+")");n.painted_x_axis.transition().duration(1E3).attr("transform","translate("+1*f+","+a.height()+")");c=p;d.shift();m++;return b};return b};function BrightStackedArea(a){return function(){var b={};b.area=d3.svg.area().interpolate("monotone").x(function(b){return a.x_scale(b.date)}).y0(function(b){return a.y_scale(b.y0)}).y1(function(b){return a.y_scale(b.y0+b.y)});b.chart_identifier="chart-"+Math.floor(1E7*Math.random());b.chart_place=a.chart_space().selectAll("."+b.chart_identifier).data(a.dataset());b.chart=b.chart_place.enter().append("path").attr("class",""+b.chart_identifier).attr("class","area").attr("d",function(a){return b.area(a.values)}).style("fill",
function(b){return a.color(b.name)});b.chart_place.exit().remove();return b}()};function BrightReader(a){function b(){var a={};b.parse_dates();g=d3.scale.category20();g.domain(d3.keys(d[0]).filter(function(a){return"date"!==a}));b.stacked_dataset();b.get_y_max();a.dataset=b.dataset;a.stacked_dataset=b.stacked_dataset;a.color=b.color();a.y_max=f;return a}var d=JSON.parse(JSON.stringify(a.dataset())),f=0,e=null,g=null;b.get_y_max=function(){var a=d3.keys(d[0]).filter(function(a){return"date"!==a});d.forEach(function(b){var d=a.map(function(a){return b[a]/1}).reduce(function(a,
b){return a+b});f<d&&(f=d)})};b.dataset=function(){return d};b.color=function(){return g};b.stacked_dataset=function(){e||(e=d3.layout.stack().values(function(a){return a.values})(g.domain().map(function(a){return{name:a,values:d.map(function(b){return{date:b.date,y:b[a]/1}})}})));return e};b.parse_date=function(a){return d3.time.format("%y-%b-%d").parse(a)};b.parse_dates=function(){d.forEach(function(a){a.date=b.parse_date(a.date)})};return b()};function BrightAxis(a){function b(){var e={};e.x_axis=b.x_axis();e.y_axis=b.y_axis();e.x_axis_place=d;e.y_axis_place=f;var c=a.painted_y||f;e.painted_x_axis=(a.painted_x||d).call(e.x_axis);a.skip||(e.painted_y_axis=c.call(e.y_axis));return e}var d=a.canvas().append("g").attr("clip-path","url(#cropxaxisright)").append("g").attr("class","x axis").attr("transform","translate(0,"+a.height()+")"),f=a.canvas().append("g").attr("clip-path","url(#cropxayisright)").append("g").attr("class","x axis"),e=null,
g=null;b.x_axis=function(){e||(e=d3.svg.axis().scale(a.x_scale).orient("bottom"));return e};b.y_axis=function(){g||(g=d3.svg.axis().scale(a.y_scale).orient("left"));return g};return b()};function BrightScales(a){function b(){var e={};e.x_scale=b.x_scale();e.y_scale=b.y_scale();d.domain(d3.extent(a.dataset(),function(a){return a.date}));f.domain([0,parseInt(a.y_max+0.1*a.y_max)]);return e}var d=null,f=null;b.x_scale=function(){d||(d=d3.time.scale().range([0,a.width()]));return d};b.y_scale=function(){f||(f=d3.scale.linear().range([a.height(),0]));return f};return b()};function BrightBuilder(a){function b(){return b.draw_canvas().read_initial_dataset().prepare_scales().build_axis().build_chart().crop_edges().listen()}var d=null,f=null,e=null,g=null,h=null;b.read_initial_dataset=function(){var c={};c.dataset=a.settings.initial_dataset;g=a.reader(c);return b};b.draw_canvas=function(){var c={};c.width=a.settings.width;c.height=a.settings.height;c.target=a.settings.target;d=a.canvas(c);return b};b.prepare_scales=function(){var c={};c.dataset=g.dataset;c.y_max=g.y_max;
c.width=d.inner_width;c.height=d.inner_height;f=a.scales(c);return b};b.build_axis=function(){var c={};c.canvas=d.canvas;c.x_scale=f.x_scale;c.y_scale=f.y_scale;c.height=d.inner_height;e=a.axis(c);return b};b.build_chart=function(){var c={};c.chart_space=d.chart_space;c.dataset=g.stacked_dataset;c.color=g.color;c.x_scale=f.x_scale;c.y_scale=f.y_scale;h=a.chart(c);return b};b.crop_edges=function(){var c={};c.canvas_object=d;c.axis_object=e;crop_object=a.cropper(c);return b};b.listen=function(){var b=
{};b.canvas=d.canvas;b.chart=h.chart;b.chart_identifier=h.chart_identifier;b.chart_place=h.chart_place;b.area=h.area;b.reader=a.reader;b.x_scale=f.x_scale;b.y_scale=f.y_scale;b.width=d.inner_width;b.height=d.inner_height;b.scales=a.scales;b.painted_x_axis=e.painted_x_axis;b.painted_y_axis=e.painted_y_axis;b.axis=a.axis;b.initial_dataset=a.settings.initial_dataset;return a.listener(b)};b.build=function(){return b()};return b};function BrightCanvas(a){function b(){var a={};a.canvas=b.canvas;a.chart_space=b.chart_space;a.inner_width=b.inner_width;a.inner_height=b.inner_height;return a}var d=d3.select(a.target()).append("svg").attr("style","background-color: lightblue").attr("width",a.width()).attr("height",a.height()).append("g").attr("transform","translate(50,20)"),f=d.append("g");b.chart_space=function(){return f};b.canvas=function(){return d};b.inner_width=function(){return a.width()-50-20};b.inner_height=function(){return a.height()-
20-30};return b()};function Bright(){function a(){var b={};b.settings=a;b.canvas=BrightCanvas;b.scales=BrightScales;b.axis=BrightAxis;b.chart=BrightStackedArea;b.reader=BrightReader;b.cropper=BrightCropper;b.listener=BrightListener;return BrightBuilder(b).build()}var b=100,d=200,f="body",e=[],g=null,h="stacked-area";a.activate=function(){return a()};a.chart_type=function(b){if(!arguments.length)return h;h=b;return a};a.initial_dataset=function(b){if(!arguments.length)return e;e=b;return a};a.data_stream=function(b){if(!arguments.length)return g;
g=b;return a};a.target=function(b){if(!arguments.length)return f;f=b;return a};a.width=function(c){if(!arguments.length)return b;b=c;return a};a.height=function(b){if(!arguments.length)return d;d=b;return a};return a}var bright=Bright();
